
(function() {
    var requiredFiles = [];
        //Adding some special requirements for this dropin
    var dibexLazyLoadHtml = angular.module('dibexLazyLoadHtml', [requiredFiles]);
    dibexLazyLoadHtml.factory('dibexLazyLoadHtmlStore',['dibDiscover', function (dibDiscover) {
        var url = function ($scope, $element) {
            return dibDiscover.addToUrl({
                field : $element.find('[dib-container=dibexLazyLoadHtml]').first(),
                $scope : $scope,
                url : DIB.base_url+"/dropins/setNgMaterial/dibHtmlTemplate/Template/open/dibexLazyLoadHtml"
            });
        };
        return {
            url : url
        };
    }]);
})();
(function() {
    var dibexLazyLoadHtml = angular.module('dibexLazyLoadHtml');
    dibexLazyLoadHtml.component('dibexLazyLoadHtml', {
        controllerAs: 'dibexLazyLoadHtml',
        templateUrl: DIB.base_url + '/dropins/setNgMaterial/dibHtmlTemplate/Template/view/dibexLazyLoadHtml.html',
        controller : component__dibexLazyLoadHtml
    });
    component__dibexLazyLoadHtml.$inject = [ '$scope','$element','dibCrud','dibNavigation','dibAction','dibContainer','dibDiscover','dibRecord','dibUtility','dibCommon','$log','$q','$ocLazyLoad', 
            'dibexLazyLoadHtmlStore','$sce', '$timeout'];
    function component__dibexLazyLoadHtml($scope,$element,dibCrud,dibNavigation,dibAction,dibContainer,dibDiscover,dibRecord,dibUtility,dibCommon,$log,$q,$ocLazyLoad, 
            dibexLazyLoadHtmlStore,$sce, $timeout) {
        var ctrl = this;
        //required for permissions
        ctrl.$onInit = function () { 
                        $scope.container = {};
            $scope.container.Id = '7153';
            $scope.container.Name = 'dibexLazyLoadHtml';
            $scope.container.SubContainerItemAliases = []; 
            var crudController = "/peff/Crud";
                    $scope.model = {};
        $scope.model._GET = dibRecord.modelConstruct($scope);
        $scope.view = {};
            var reloadContainerFunctions = [];
            dibContainer.watchModel($scope);
	        $scope.dibCommon = dibCommon;
            $scope.primaryKeys = [];
        var $dibContainer = $element.first();
        $scope.menus = {};
    $scope.dropdowns = {};
            $scope.openAuditTrail = function (portAlias) {
                $log.warn('Audit trail not available for this container, as a table is not linked to this view');
            };
              function setupUrl() { 
                var url = dibexLazyLoadHtmlStore.url($scope,$element);
                if (!!url.url == false) return;
                var tmpUri = url.url;
                if (tmpUri.indexOf("?") !== -1) {
                tmpUri += "&" + $.param(url.data) + "&v="+new Date().getTime();
                } else {
                tmpUri += "?" + $.param(url.data)+ "&v="+new Date().getTime();
                }
                $sce.trustAsResourceUrl(tmpUri);
                $scope.loading = true;
                $timeout(function () {
                    $scope.loading = false;
                },500);
                $scope.model.url = tmpUri;
            }
            if (!!dibContainer.isSubContainer($("[dib-container=dibexLazyLoadHtml]")) === false) { 
                setupUrl();
            }
            $scope.completed = function () {
                $scope.loading = false;
            };
            $scope.reloadContainer = function (options) {
                    setupUrl();
                $scope.frameStyle = {
                    "height" : "200px"
                };
                //@TODO to figure out how to update the screen height
                // $timeout(function () { 
                //     $scope.frameStyle = {
                //         "height" : $('[dib-container=dibexLazyLoadHtml]').contents().find('body').height() + "px"
                //     };
                // }, 100);
            };
        };
        ctrl.$postLink = function () {
        };
    }  
})();
